version: 2

models:
  - name: fct_tiktok_music_joined_features
    description: >
      This model aggregates TikTok video engagement metrics with Spotify music features to analyze how musical attributes and post timing influence user interaction. It includes composite features such as intensity, rhythm, and sound type based on various audio characteristics from Spotify's API, along with quartile-based segmentations for further analysis.

    columns:
      - name: music_id
        description: The unique identifier for the music track in TikTok. 
        data_tests:
          - not_null
          - unique

      - name: artist_name
        description: The name of the artist for the corresponding music track. 

      - name: track_id
        description: The Spotify track identifier for each piece of music.
        data_tests:
          - unique

      - name: track_name
        description: The name of the music track. 

      - name: genres
        description: The generalized music genre associated with the track. 

      - name: genre_value
        description: A continuous numerical representation of the genres.

      - name: intensity
        description: >
          Composite feature created by combining energy and loudness. 
          Formula: `(energy + (loudness + 60) / 60) / 2`, where loudness is adjusted to a more neutral scale before combining.
        data_tests:
          -  dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 1

      - name: rhythm
        description: >
          Composite feature derived from danceability, positiveness, and tempo. 
          Formula: `(danceability * 0.4 + positiveness * 0.4 + (tempo / 200) * 0.2)`.
        data_tests:
          -  dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 1

      - name: sound_type
        description: >
          Composite feature combining acousticness, instrumentalness, and speechiness.
        data_tests:
          -  dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 1

      - name: popularity
        description: The popularity score of the track as provided by Spotify.

      - name: liveness
        description: Describes the presence of a live audience in the track.

      - name: beats_per_bar
        description: The number of beats in each bar of the track, representing the time signature.

      - name: number_of_videos
        description: The total number of TikTok videos using this specific music track. 

      - name: total_likes_count
        description: The total number of likes across all TikTok videos using this music track. 

      - name: total_shares_count
        description: The total number of shares across all TikTok videos using this music track. 

      - name: total_comment_count
        description: The total number of comments across all TikTok videos using this music track. 

      - name: total_play_count
        description: The total number of play counts across all TikTok videos using this music track. 
